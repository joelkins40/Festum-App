<!-- 游닇 Modal para Crear/Editar Clientes -->
<div class="cliente-dialog">

  <!-- Header del Modal -->
  <div class="dialog-header">
    <div class="header-content">
      <mat-icon class="header-icon">{{ modo === 'crear' ? 'person_add' : 'edit' }}</mat-icon>
      <h2 class="header-title">{{ modo === 'crear' ? 'Nuevo Cliente' : 'Editar Cliente' }}</h2>
    </div>
    <button mat-icon-button (click)="cancelar()" class="close-button" matTooltip="Cerrar">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Contenido del Modal -->
  <div class="dialog-content">
    <form [formGroup]="clienteForm" class="cliente-form">

      <!-- CAMPO NOMBRE -->
      <div class="section-card">

        <div class="form-section">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nombre completo del cliente</mat-label>
            <input matInput formControlName="nombre" placeholder="Ej: Mar칤a Gonz치lez Rodr칤guez..." maxlength="100"
              #nombreInput>
            <mat-icon matPrefix class="input-icon">person</mat-icon>

            <!-- Mensajes de Error -->
            <mat-error *ngIf="nombre?.hasError('required')">
              El nombre es requerido
            </mat-error>
            <mat-error *ngIf="nombre?.hasError('minlength')">
              El nombre debe tener al menos 2 caracteres
            </mat-error>
            <mat-error *ngIf="nombre?.hasError('maxlength')">
              El nombre no puede exceder 100 caracteres
            </mat-error>
            <mat-error *ngIf="nombre?.hasError('pattern')">
              Solo se permiten letras y espacios
            </mat-error>

            <!-- Contador de caracteres -->
            <mat-hint align="end">
              {{ nombreInput.value.length || 0 }}/100
            </mat-hint>
          </mat-form-field>
        </div>
      </div>


      <!-- SECCI칍N DE DIRECCI칍N -->
      <div class="section-card">
        <div class="form-section" formGroupName="direccion">
          <div class="section-header">
            <mat-icon class="section-icon">location_on</mat-icon>
            <h3 class="section-title">Direcci칩n del Cliente</h3>
          </div>

          <!-- Direcci칩n Completa -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Direcci칩n completa</mat-label>
            <textarea matInput formControlName="fullAddress"
              placeholder="Ej: Av. Revoluci칩n 1234, Col. Centro, Guadalajara, Jalisco 44100, M칠xico" maxlength="300"
              rows="2" #fullAddressInput></textarea>
            <mat-icon matPrefix class="input-icon">place</mat-icon>
            <mat-error *ngIf="direccionFullAddress?.hasError('required')">La direcci칩n completa es requerida</mat-error>
            <mat-error *ngIf="direccionFullAddress?.hasError('maxlength')">M치ximo 300 caracteres</mat-error>
            <mat-hint align="end">{{ fullAddressInput.value.length || 0 }}/300</mat-hint>
          </mat-form-field>

          <!-- Fila 1: Calle y N칰mero -->
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field-large">
              <mat-label>Calle</mat-label>
              <input matInput formControlName="street" placeholder="Ej: Av. Revoluci칩n" maxlength="100">
              <mat-error *ngIf="direccionStreet?.hasError('required')">La calle es requerida</mat-error>
              <mat-error *ngIf="direccionStreet?.hasError('maxlength')">M치ximo 100 caracteres</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field-small">
              <mat-label>N칰mero</mat-label>
              <input matInput formControlName="number" placeholder="1234" maxlength="20">
              <mat-error *ngIf="direccionNumber?.hasError('required')">El n칰mero es requerido</mat-error>
              <mat-error *ngIf="direccionNumber?.hasError('maxlength')">M치ximo 20 caracteres</mat-error>
            </mat-form-field>
          </div>

          <!-- Fila 2: Colonia y Ciudad -->
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field-half">
              <mat-label>Colonia/Barrio</mat-label>
              <input matInput formControlName="neighborhood" placeholder="Ej: Centro" maxlength="100">
              <mat-error *ngIf="direccionNeighborhood?.hasError('required')">La colonia es requerida</mat-error>
              <mat-error *ngIf="direccionNeighborhood?.hasError('maxlength')">M치ximo 100 caracteres</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field-half">
              <mat-label>Ciudad</mat-label>
              <input matInput formControlName="city" placeholder="Ej: Guadalajara" maxlength="100">
              <mat-error *ngIf="direccionCity?.hasError('required')">La ciudad es requerida</mat-error>
              <mat-error *ngIf="direccionCity?.hasError('maxlength')">M치ximo 100 caracteres</mat-error>
            </mat-form-field>
          </div>

          <!-- Fila 3: Estado y C칩digo Postal -->
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field-large">
              <mat-label>Estado</mat-label>
              <input matInput formControlName="state" placeholder="Ej: Jalisco" maxlength="100">
              <mat-error *ngIf="direccionState?.hasError('required')">El estado es requerido</mat-error>
              <mat-error *ngIf="direccionState?.hasError('maxlength')">M치ximo 100 caracteres</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field-small">
              <mat-label>C.P.</mat-label>
              <input matInput formControlName="postalCode" placeholder="44100" maxlength="5" type="text">
              <mat-error *ngIf="direccionPostalCode?.hasError('required')">El c칩digo postal es requerido</mat-error>
              <mat-error *ngIf="direccionPostalCode?.hasError('pattern')">Debe ser un c칩digo postal v치lido (5
                d칤gitos)</mat-error>
            </mat-form-field>
          </div>

          <!-- Fila 4: Pa칤s -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Pa칤s</mat-label>
            <input matInput formControlName="country" maxlength="100">
            <mat-error *ngIf="direccionCountry?.hasError('required')">El pa칤s es requerido</mat-error>
            <mat-error *ngIf="direccionCountry?.hasError('maxlength')">M치ximo 100 caracteres</mat-error>
          </mat-form-field>

          <!-- Fila 5: Coordenadas (opcional/oculto por ahora) -->
          <div class="coordinates-section" style="display: none;">
            <div class="form-row">
              <mat-form-field appearance="outline" class="form-field-half">
                <mat-label>Latitud</mat-label>
                <input matInput formControlName="lat" type="number" step="any" placeholder="20.6736">
                <mat-error *ngIf="direccionLat?.hasError('required')">La latitud es requerida</mat-error>
                <mat-error *ngIf="direccionLat?.hasError('min') || direccionLat?.hasError('max')">Latitud
                  inv치lida</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field-half">
                <mat-label>Longitud</mat-label>
                <input matInput formControlName="lng" type="number" step="any" placeholder="-103.3744">
                <mat-error *ngIf="direccionLng?.hasError('required')">La longitud es requerida</mat-error>
                <mat-error *ngIf="direccionLng?.hasError('min') || direccionLng?.hasError('max')">Longitud
                  inv치lida</mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>

      <!-- CAMPO CLIENTE PREFERENTE -->
      <div class="section-card">
        <div class="form-section">
          <div class="checkbox-container">
            <mat-checkbox formControlName="clientePreferente" class="cliente-preferente-checkbox">
              <div class="checkbox-content">
                <div class="checkbox-label">
                  <mat-icon class="checkbox-icon">star</mat-icon>
                  <span class="checkbox-text">Cliente Preferente</span>
                </div>
                <div class="checkbox-description">
                  Los clientes preferentes reciben descuentos especiales y atenci칩n prioritaria
                </div>
              </div>
            </mat-checkbox>
          </div>
        </div>
      </div>

      <!-- INFORMACI칍N ADICIONAL PARA EDICI칍N -->

      <div class="info-section" *ngIf="modo === 'editar' && data.cliente">
        <div class="info-card">
          <h4 class="info-title">
            <mat-icon>info</mat-icon>
            Informaci칩n del Registro
          </h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Fecha de creaci칩n:</span>
              <span class="info-value">{{ data.cliente?.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">ID:</span>
              <span class="info-value">#{{ data.cliente?.id }}</span>
            </div>
          </div>
        </div>
      </div>

    </form>
  </div>

  <!-- Footer con botones de acci칩n -->
  <div class="dialog-footer">
    <div class="button-group">
      <button mat-button (click)="cancelar()" class="cancel-button" [disabled]="guardando">
        <mat-icon>cancel</mat-icon>
        Cancelar
      </button>

      <button mat-raised-button color="primary" (click)="guardar()" class="save-button"
        [disabled]="!esFormularioValido || guardando">
        <mat-icon>{{ guardando ? 'hourglass_empty' : (modo === 'crear' ? 'save' : 'update') }}</mat-icon>
        {{ guardando ? 'Guardando...' : (modo === 'crear' ? 'Crear Cliente' : 'Actualizar Cliente') }}
      </button>
    </div>
  </div>

</div>
