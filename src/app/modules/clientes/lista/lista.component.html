<!-- ===== CLIENTES COMPONENT ===== -->
<div class="clientes-container">

  <!-- Header Principal -->
  <div class="page-header">
    <div class="header-content">
      <div class="page-title">
        <mat-icon class="page-icon">people</mat-icon>
        <h1>Gestión de Clientes</h1>
      </div>
      <p class="page-description">
        Administra la información de los clientes y sus preferencias
      </p>
    </div>

    <!-- Action Button -->
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="crearCliente()" class="create-button">
        <mat-icon>person_add</mat-icon>
        Nuevo Cliente
      </button>
    </div>
  </div>

  <!-- Loading Global -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-content">
      <mat-progress-spinner diameter="60" mode="indeterminate" color="primary">
      </mat-progress-spinner>
      <p>Cargando clientes...</p>
    </div>
  </div>

  <!-- Main Content Card -->
  <mat-card class="main-card">

    <!-- Toolbar de Acciones -->
    <div class="table-toolbar">
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar clientes</mat-label>
          <input matInput [(ngModel)]="filtroTexto" (keyup)="aplicarFiltros()" placeholder="Buscar por nombre...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Filtrar por tipo</mat-label>
          <mat-select [(ngModel)]="filtroClientePreferente" (selectionChange)="aplicarFiltros()">
            <mat-option *ngFor="let opcion of opcionesClientePreferente" [value]="opcion.value">
              {{ opcion.label }}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>filter_list</mat-icon>
        </mat-form-field>
      </div>

      <div class="action-buttons">
        <!-- Botón Importar -->
        <button mat-raised-button color="accent" (click)="abrirImportarCSV()" [disabled]="loading"
          class="toolbar-button">
          <mat-icon>upload</mat-icon>
          Importar CSV
        </button>

        <!-- Botón Exportar -->
        <button mat-raised-button color="primary" (click)="exportarCSV()"
          [disabled]="loading || dataSource.data.length === 0" class="toolbar-button export-button">
          <mat-icon>download</mat-icon>
          Exportar CSV
        </button>

        <!-- Botón Limpiar Filtros -->
        <button mat-icon-button (click)="limpiarFiltros()" [disabled]="loading" matTooltip="Limpiar filtros"
          class="toolbar-button">
          <mat-icon>clear_all</mat-icon>
        </button>
      </div>
    </div>

    <mat-divider class="toolbar-divider"></mat-divider>

    <!-- Tabla Principal -->
    <div class="table-container">

      <!-- Overlay de Loading para tabla -->
      <div class="table-loading-overlay" *ngIf="loading">
        <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
        <span class="loading-text">Cargando datos...</span>
      </div>

      <table mat-table [dataSource]="dataSource" class="clientes-table" matSort>

        <!-- Columna ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="id-column">ID</th>
          <td mat-cell *matCellDef="let cliente" class="id-cell">
            <span class="id-badge">{{ cliente.id }}</span>
          </td>
        </ng-container>

        <!-- Columna Nombre -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="nombre-column">Nombre</th>
          <td mat-cell *matCellDef="let cliente" class="nombre-cell">
            <div class="cliente-info">
              <mat-icon class="cliente-icon">person</mat-icon>
              <span class="cliente-text">{{ cliente.nombre }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Dirección -->
        <ng-container matColumnDef="direccion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="direccion-column">Dirección</th>
          <td mat-cell *matCellDef="let cliente" class="direccion-cell">
            <div class="direccion-info">
              <mat-icon class="direccion-icon">location_on</mat-icon>
              <span class="direccion-text" [title]="cliente.direccion.fullAddress">
                {{ cliente.direccion.fullAddress }}
              </span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Cliente Preferente -->
        <ng-container matColumnDef="clientePreferente">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="preferente-column">Tipo</th>
          <td mat-cell *matCellDef="let cliente" class="preferente-cell">
            <mat-chip class="preferente-chip" [ngClass]="cliente.clientePreferente ? 'preferente' : 'regular'">
              <mat-icon class="preferente-icon">
                {{ cliente.clientePreferente ? 'star' : 'person_outline' }}
              </mat-icon>
              {{ cliente.clientePreferente ? 'Preferente' : 'Regular' }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Columna Fecha Creación -->
        <ng-container matColumnDef="fechaCreacion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="fecha-column">Fecha de Registro</th>
          <td mat-cell *matCellDef="let cliente" class="fecha-cell">
            <div class="fecha-info">
              <mat-icon class="fecha-icon">schedule</mat-icon>
              <span>{{ cliente.fechaCreacion | date:'dd/MM/yyyy' }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Estado -->
        <ng-container matColumnDef="activo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="estado-column">Estado</th>
          <td mat-cell *matCellDef="let cliente" class="estado-cell">
            <mat-chip class="estado-chip" [ngClass]="cliente.activo ? 'activo' : 'inactivo'">
              <mat-icon class="estado-icon">
                {{ cliente.activo ? 'check_circle' : 'cancel' }}
              </mat-icon>
              {{ cliente.activo ? 'Activo' : 'Inactivo' }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Columna Acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef class="acciones-column">Acciones</th>
          <td mat-cell *matCellDef="let cliente" class="acciones-cell">
            <div class="acciones-container">
              <button mat-icon-button (click)="editarCliente(cliente)" matTooltip="Editar cliente" class="edit-button">
                <mat-icon>edit</mat-icon>
              </button>

              <button mat-icon-button (click)="eliminarCliente(cliente)" matTooltip="Eliminar cliente"
                class="delete-button">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <!-- Header y filas de datos -->
        <tr mat-header-row *matHeaderRowDef="columnasDisplayed" class="table-header"></tr>
        <tr mat-row *matRowDef="let row; columns: columnasDisplayed;" class="table-row"></tr>

        <!-- Mensaje cuando no hay datos -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell no-data-cell" [attr.colspan]="columnasDisplayed.length">
            <div class="no-data-message">
              <mat-icon class="no-data-icon">people_outline</mat-icon>
              <div class="no-data-text">No se encontraron clientes</div>
              <p class="no-data-subtitle">
                {{ filtroTexto || filtroClientePreferente !== 'todos' ? 'Intenta ajustar los filtros de búsqueda' :
                'Comienza registrando tu primer cliente' }}
              </p>
            </div>
          </td>
        </tr>

      </table>
    </div>

    <!-- Paginador -->
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 50]" [pageSize]="10" showFirstLastButtons class="table-paginator">
    </mat-paginator>

  </mat-card>

  <!-- Input oculto para CSV -->
  <input type="file" #fileInput accept=".csv" (change)="procesarArchivoCSV($event)" style="display: none;">

</div>
