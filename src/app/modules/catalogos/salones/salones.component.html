<!-- ===== SALONES COMPONENT ===== -->
<div class="salones-container">

  <!-- Header Principal -->
  <div class="page-header">
    <div class="header-content">
      <div class="page-title">
        <mat-icon class="page-icon">business</mat-icon>
        <h1>Gestión de Salones</h1>
      </div>
      <p class="page-description">
        Administra los salones de eventos disponibles en el sistema
      </p>
    </div>

    <!-- Action Button -->
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="abrirModalCrear()" class="create-button">
        <mat-icon>add_business</mat-icon>
        Nuevo Salón
      </button>
    </div>
  </div>

  <!-- Loading Global -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-content">
      <mat-progress-spinner diameter="60" mode="indeterminate" color="primary">
      </mat-progress-spinner>
      <p>Cargando salones...</p>
    </div>
  </div>

  <!-- Main Content Card -->
  <mat-card class="main-card">

    <!-- Toolbar de Acciones -->
    <div class="table-toolbar">
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar salones</mat-label>
          <input matInput [(ngModel)]="filtroTexto" (keyup)="aplicarFiltros()"
            placeholder="Buscar por nombre, dirección o tipo...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <!-- Filtro por Tipo de Evento -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Tipo de evento</mat-label>
          <mat-select [(ngModel)]="filtroTipoEvento" (selectionChange)="aplicarFiltros()">
            <mat-option value="">Todos los tipos</mat-option>
            <mat-option *ngFor="let tipo of tiposEvento" [value]="tipo.id">
              {{ tipo.descripcion }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Filtro por Estado -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Estado</mat-label>
          <mat-select [(ngModel)]="filtroActivo" (selectionChange)="aplicarFiltros()">
            <mat-option *ngFor="let opcion of opcionesActivo" [value]="opcion.value">
              {{ opcion.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="action-buttons">
        <!-- Botón Importar -->
        <button mat-raised-button color="accent" (click)="abrirImportador()" [disabled]="loading"
          class="toolbar-button">
          <mat-icon>upload</mat-icon>
          Importar CSV
        </button>

        <!-- Botón Exportar -->
        <button mat-raised-button color="primary" (click)="exportarCSV()"
          [disabled]="loading || dataSource.data.length === 0" class="toolbar-button export-button">
          <mat-icon>download</mat-icon>
          Exportar CSV
        </button>

        <!-- Botón Refrescar -->
        <button mat-icon-button (click)="cargarDatos()" [disabled]="loading" matTooltip="Refrescar datos">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>

    <mat-divider class="toolbar-divider"></mat-divider>

    <!-- Tabla de Salones -->
    <div class="table-container">
      <table mat-table [dataSource]="dataSource" matSort class="salones-table">

        <!-- Columna ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="id-column">ID</th>
          <td mat-cell *matCellDef="let salon" class="id-cell">
            <span class="id-badge">{{ salon.id }}</span>
          </td>
        </ng-container>

        <!-- Columna Nombre -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="nombre-column">Nombre</th>
          <td mat-cell *matCellDef="let salon" class="nombre-cell">
            <div class="salon-info">
              <mat-icon class="salon-icon">business</mat-icon>
              <span class="salon-text">{{ salon.nombre }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Dirección -->
        <ng-container matColumnDef="direccion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="direccion-column">Dirección</th>
          <td mat-cell *matCellDef="let salon" class="direccion-cell">
            <div class="direccion-info">
              <mat-icon class="direccion-icon">location_on</mat-icon>
              <span class="direccion-text">{{ salon.direccion }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Capacidad -->
        <ng-container matColumnDef="capacidad">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="capacidad-column">Capacidad</th>
          <td mat-cell *matCellDef="let salon" class="capacidad-cell">
            <div class="capacidad-info">
              <mat-icon class="capacidad-icon">people</mat-icon>
              <span class="capacidad-text">{{ salon.capacidadDePersonas }} personas</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Tipo de Evento -->
        <ng-container matColumnDef="tipoEvento">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="tipo-column">Tipo de Evento</th>
          <td mat-cell *matCellDef="let salon" class="tipo-cell">
            <mat-chip class="tipo-chip">
              <mat-icon class="tipo-icon">event</mat-icon>
              {{ salon.tipoEvento.descripcion }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Columna Precio -->
        <ng-container matColumnDef="precio">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="precio-column">Precio</th>
          <td mat-cell *matCellDef="let salon" class="precio-cell">
            <div class="precio-info">
              <mat-icon class="precio-icon">attach_money</mat-icon>
              <span class="precio-text">{{ salon.precioRenta | currency:'MXN' }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Teléfono -->
        <ng-container matColumnDef="telefono">
          <th mat-header-cell *matHeaderCellDef class="telefono-column">Teléfono</th>
          <td mat-cell *matCellDef="let salon" class="telefono-cell">
            <div class="telefono-info" *ngIf="salon.telefonoContacto">
              <mat-icon class="telefono-icon">phone</mat-icon>
              <span class="telefono-text">{{ salon.telefonoContacto }}</span>
            </div>
            <span class="no-telefono" *ngIf="!salon.telefonoContacto">-</span>
          </td>
        </ng-container>

        <!-- Columna Estado -->
        <ng-container matColumnDef="activo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="estado-column">Estado</th>
          <td mat-cell *matCellDef="let salon" class="estado-cell">
            <mat-chip class="estado-chip" [ngClass]="salon.activo ? 'activo' : 'inactivo'">
              <mat-icon class="estado-icon">
                {{ salon.activo ? 'check_circle' : 'cancel' }}
              </mat-icon>
              {{ salon.activo ? 'Activo' : 'Inactivo' }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Columna Acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef class="acciones-column">Acciones</th>
          <td mat-cell *matCellDef="let salon" class="acciones-cell">
            <div class="acciones-container">
              <button mat-icon-button class="edit-button" (click)="abrirModalEditar(salon)" matTooltip="Editar salón"
                [disabled]="loading">
                <mat-icon>edit</mat-icon>
              </button>

              <button mat-icon-button class="delete-button" (click)="confirmarEliminacion(salon)"
                matTooltip="Eliminar salón" [disabled]="loading">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <!-- Header y Filas -->
        <tr mat-header-row *matHeaderRowDef="columnasDisplayed" class="table-header"></tr>
        <tr mat-row *matRowDef="let row; columns: columnasDisplayed;" class="table-row"
          [class.selected]="row.id === salonSeleccionado?.id"></tr>

        <!-- Mensaje cuando no hay datos -->
        <tr class="mat-row no-data-row" *matNoDataRow>
          <td class="mat-cell no-data-cell" [attr.colspan]="columnasDisplayed.length">
            <div class="no-data-message">
              <mat-icon class="no-data-icon">business_center</mat-icon>
              <span class="no-data-text">No se encontraron salones</span>
              <p class="no-data-subtitle">Intenta ajustar tus criterios de búsqueda o crear un nuevo salón</p>
            </div>
          </td>
        </tr>
      </table>

      <!-- Loading Overlay dentro de la tabla -->
      <div *ngIf="loading" class="table-loading-overlay">
        <mat-progress-spinner color="primary" mode="indeterminate" diameter="60">
        </mat-progress-spinner>
        <p class="loading-text">Cargando salones...</p>
      </div>
    </div>

    <!-- Paginador -->
    <mat-paginator [pageSizeOptions]="[5, 10, 20, 50]" [pageSize]="10" showFirstLastButtons class="table-paginator">
    </mat-paginator>
  </mat-card>

  <!-- Input oculto para CSV -->
  <input #fileInput type="file" accept=".csv" (change)="procesarArchivoCSV($event)" style="display: none;">
</div>
