<!-- ===== TIPOS MOBILIARIO COMPONENT ===== -->
<div class="tipos-mobiliario-container">

  <!-- Header Principal -->
  <div class="page-header">
    <div class="header-content">
      <div class="page-title">
        <mat-icon class="page-icon">chair</mat-icon>
        <h1>Gestión de Tipos de Mobiliario</h1>
      </div>
      <p class="page-description">
        Administra los tipos de mobiliario disponibles para eventos
      </p>
    </div>

    <!-- Action Button -->
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="crearTipoMobiliario()" class="create-button">
        <mat-icon>add_box</mat-icon>
        Nuevo Tipo de Mobiliario
      </button>
    </div>
  </div>

  <!-- Loading Global -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-content">
      <mat-progress-spinner diameter="60" mode="indeterminate" color="primary">
      </mat-progress-spinner>
      <p>Cargando tipos de mobiliario...</p>
    </div>
  </div>

  <!-- Main Content Card -->
  <mat-card class="main-card">

    <!-- Toolbar de Acciones -->
    <div class="table-toolbar">
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar tipos de mobiliario</mat-label>
          <input matInput [(ngModel)]="filtroTexto" (keyup)="aplicarFiltros()" placeholder="Buscar por descripción...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Filtrar por estado</mat-label>
          <mat-select [(ngModel)]="filtroEstado" (selectionChange)="aplicarFiltros()">
            <mat-option *ngFor="let opcion of opcionesEstado" [value]="opcion.value">
              {{ opcion.label }}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>filter_list</mat-icon>
        </mat-form-field>
      </div>

      <div class="action-buttons">
        <!-- Botón Importar -->
        <button mat-raised-button color="accent" (click)="abrirImportarCSV()" [disabled]="loading"
          class="toolbar-button">
          <mat-icon>upload</mat-icon>
          Importar CSV
        </button>

        <!-- Botón Exportar -->
        <button mat-raised-button color="primary" (click)="exportarCSV()"
          [disabled]="loading || dataSource.data.length === 0" class="toolbar-button export-button">
          <mat-icon>download</mat-icon>
          Exportar CSV
        </button>

        <!-- Botón Limpiar Filtros -->
        <button mat-icon-button (click)="limpiarFiltros()" [disabled]="loading" matTooltip="Limpiar filtros"
          class="toolbar-button">
          <mat-icon>clear_all</mat-icon>
        </button>
      </div>
    </div>

    <mat-divider class="toolbar-divider"></mat-divider>

    <!-- Tabla Principal -->
    <div class="table-container">

      <!-- Overlay de Loading para tabla -->
      <div class="table-loading-overlay" *ngIf="loading">
        <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
        <span class="loading-text">Cargando datos...</span>
      </div>

      <table mat-table [dataSource]="dataSource" class="tipos-mobiliario-table" matSort>

        <!-- Columna ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="id-column">ID</th>
          <td mat-cell *matCellDef="let tipo" class="id-cell">
            <span class="id-badge">{{ tipo.id }}</span>
          </td>
        </ng-container>

        <!-- Columna Descripción -->
        <ng-container matColumnDef="descripcion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="descripcion-column">Descripción</th>
          <td mat-cell *matCellDef="let tipo" class="descripcion-cell">
            <div class="tipo-info">
              <mat-icon class="tipo-icon">chair</mat-icon>
              <span class="tipo-text">{{ tipo.descripcion }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Fecha Creación -->
        <ng-container matColumnDef="fechaCreacion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="fecha-column">Fecha de Creación</th>
          <td mat-cell *matCellDef="let tipo" class="fecha-cell">
            <div class="fecha-info">
              <mat-icon class="fecha-icon">schedule</mat-icon>
              <span>{{ tipo.fechaCreacion | date:'dd/MM/yyyy' }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Estado -->
        <ng-container matColumnDef="activo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="estado-column">Estado</th>
          <td mat-cell *matCellDef="let tipo" class="estado-cell">
            <mat-chip class="estado-chip" [ngClass]="tipo.activo ? 'activo' : 'inactivo'">
              <mat-icon class="estado-icon">
                {{ tipo.activo ? 'check_circle' : 'cancel' }}
              </mat-icon>
              {{ tipo.activo ? 'Activo' : 'Inactivo' }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Columna Acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef class="acciones-column">Acciones</th>
          <td mat-cell *matCellDef="let tipo" class="acciones-cell">
            <div class="acciones-container">
              <button mat-icon-button (click)="editarTipoMobiliario(tipo)" matTooltip="Editar tipo de mobiliario"
                class="edit-button">
                <mat-icon>edit</mat-icon>
              </button>

              <button mat-icon-button (click)="eliminarTipoMobiliario(tipo)" matTooltip="Eliminar tipo de mobiliario"
                class="delete-button">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <!-- Header y filas de datos -->
        <tr mat-header-row *matHeaderRowDef="columnasDisplayed" class="table-header"></tr>
        <tr mat-row *matRowDef="let row; columns: columnasDisplayed;" class="table-row"></tr>

        <!-- Mensaje cuando no hay datos -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell no-data-cell" [attr.colspan]="columnasDisplayed.length">
            <div class="no-data-message">
              <mat-icon class="no-data-icon">chair_alt</mat-icon>
              <div class="no-data-text">No se encontraron tipos de mobiliario</div>
              <p class="no-data-subtitle">
                {{ filtroTexto || filtroEstado !== 'todos' ? 'Intenta ajustar los filtros de búsqueda' : 'Comienza
                creando tu primer tipo de mobiliario' }}
              </p>
            </div>
          </td>
        </tr>

      </table>
    </div>

    <!-- Paginador -->
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 50]" [pageSize]="10" showFirstLastButtons class="table-paginator">
    </mat-paginator>

  </mat-card>

  <!-- Input oculto para CSV -->
  <input type="file" #fileInput accept=".csv" (change)="procesarArchivoCSV($event)" style="display: none;">

</div>
